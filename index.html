<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Gist Viewer</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; cursor: pointer; }
        th:hover { background-color: #ddd; }
        .sort-icon::after { content: ''; padding-left: 5px; }
        .sort-icon.asc::after { content: '\25B2'; }
        .sort-icon.desc::after { content: '\25BC'; }
        #error { color: red; }
        #loading, #pagination { text-align: center; margin-top: 20px; }
        #pagination button { margin: 0 5px; }
    </style>
</head>
<body>
    <h1>GitHub Gist Viewer</h1>
    <input type="text" id="username" placeholder="Enter GitHub username" aria-label="GitHub username">
    <button id="fetchButton">Fetch Gists</button>
    <input type="text" id="search" placeholder="Search by description" aria-label="Search gists">
    <div id="error" role="alert"></div>
    <div id="loading"></div>
    <table id="gistsTable" aria-label="Gists table">
        <thead>
            <tr>
                <th data-sort="description">Description <span class="sort-icon"></span></th>
                <th data-sort="files">Files <span class="sort-icon"></span></th>
                <th data-sort="created">Created <span class="sort-icon"></span></th>
                <th data-sort="updated">Updated <span class="sort-icon"></span></th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <div id="pagination">
        <button id="prevPage" disabled>Previous</button>
        <span id="pageInfo"></span>
        <button id="nextPage" disabled>Next</button>
    </div>

    <script>
    class GistViewer {
        constructor() {
            this.gists = [];
            this.currentSort = { key: 'updated', ascending: false };
            this.currentPage = 1;
            this.perPage = 30;
            this.totalPages = 1;

            this.elements = {
                username: document.getElementById('username'),
                fetchButton: document.getElementById('fetchButton'),
                search: document.getElementById('search'),
                error: document.getElementById('error'),
                loading: document.getElementById('loading'),
                table: document.getElementById('gistsTable'),
                prevPage: document.getElementById('prevPage'),
                nextPage: document.getElementById('nextPage'),
                pageInfo: document.getElementById('pageInfo')
            };

            this.init();
        }

        init() {
            this.elements.fetchButton.addEventListener('click', () => this.fetchGists());
            this.elements.search.addEventListener('input', () => this.filterGists());
            this.elements.prevPage.addEventListener('click', () => this.changePage(-1));
            this.elements.nextPage.addEventListener('click', () => this.changePage(1));
            this.elements.table.querySelector('thead').addEventListener('click', (e) => {
                const th = e.target.closest('th');
                if (th) this.sortGists(th.dataset.sort);
            });

            const urlUsername = new URLSearchParams(window.location.search).get('username');
            if (urlUsername) {
                this.elements.username.value = urlUsername;
                this.fetchGists();
            }
        }

        async fetchGists() {
            const username = this.elements.username.value;
            if (!username) return this.showError('Please enter a GitHub username');

            this.showLoading(true);
            this.showError('');

            try {
                const response = await fetch(`https://api.github.com/users/${username}/gists?per_page=${this.perPage}&page=${this.currentPage}`);
                if (!response.ok) throw new Error(response.status === 404 ? 'User not found' : `HTTP error! status: ${response.status}`);
                
                const linkHeader = response.headers.get('Link');
                this.totalPages = linkHeader ? parseInt(linkHeader.match(/&page=(\d+)>; rel="last"/)?.[1] || 1) : 1;

                this.gists = await response.json();
                this.updatePagination();
                this.sortGists('updated');
            } catch (error) {
                this.showError(error.message);
            } finally {
                this.showLoading(false);
            }
        }

        filterGists() {
            const searchTerm = this.elements.search.value.toLowerCase();
            const filteredGists = this.gists.filter(gist => (gist.description || '').toLowerCase().includes(searchTerm));
            this.displayGists(filteredGists);
        }

        sortGists(key) {
            this.currentSort = key === this.currentSort.key ? 
                { key, ascending: !this.currentSort.ascending } : 
                { key, ascending: true };

            const sortedGists = [...this.gists].sort((a, b) => {
                let valueA, valueB;
                switch(key) {
                    case 'description': [valueA, valueB] = [a.description || '', b.description || '']; break;
                    case 'files': [valueA, valueB] = [Object.keys(a.files).length, Object.keys(b.files).length]; break;
                    case 'created': [valueA, valueB] = [new Date(a.created_at), new Date(b.created_at)]; break;
                    case 'updated': [valueA, valueB] = [new Date(a.updated_at), new Date(b.updated_at)]; break;
                }
                return this.currentSort.ascending ? valueA - valueB : valueB - valueA;
            });

            this.updateSortIcons();
            this.displayGists(sortedGists);
        }

        displayGists(gists) {
            const tbody = this.elements.table.querySelector('tbody');
            tbody.innerHTML = gists.map(gist => `
                <tr>
                    <td><a href="${gist.html_url}" target="_blank">${gist.description || 'No description'}</a></td>
                    <td>${Object.keys(gist.files).length}</td>
                    <td>${new Date(gist.created_at).toLocaleDateString()}</td>
                    <td>${new Date(gist.updated_at).toLocaleDateString()}</td>
                </tr>
            `).join('');
        }

        updateSortIcons() {
            this.elements.table.querySelectorAll('th').forEach(th => {
                const icon = th.querySelector('.sort-icon');
                icon.className = 'sort-icon';
                if (th.dataset.sort === this.currentSort.key) {
                    icon.classList.add(this.currentSort.ascending ? 'asc' : 'desc');
                    th.setAttribute('aria-sort', this.currentSort.ascending ? 'ascending' : 'descending');
                } else {
                    th.setAttribute('aria-sort', 'none');
                }
            });
        }

        updatePagination() {
            this.elements.prevPage.disabled = this.currentPage === 1;
            this.elements.nextPage.disabled = this.currentPage === this.totalPages;
            this.elements.pageInfo.textContent = `Page ${this.currentPage} of ${this.totalPages}`;
        }

        async changePage(delta) {
            this.currentPage += delta;
            await this.fetchGists();
        }

        showLoading(isLoading) {
            this.elements.loading.textContent = isLoading ? 'Loading...' : '';
        }

        showError(message) {
            this.elements.error.textContent = message;
        }
    }

    new GistViewer();
    </script>
</body>
</html>
